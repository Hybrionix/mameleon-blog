---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const { title, description } = Astro.props;
const path = Astro.url.pathname;
const lang = path.startsWith('/en') ? 'en' : 'nl';
const nlPath = lang === 'en' ? path.replace(/^\/en/, '') || '/' : path;
const enPath = lang === 'nl' ? '/en' + (path === '/' ? '' : path) : path;
---
<html lang={lang}>
  <head>
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <BaseHead title={title} description={description} />
  </head>
  <body>
    <Header lang={lang} nlPath={nlPath} enPath={enPath} />
    <main>
      <slot />
    </main>
    <Footer />
    <script>
      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          window.location.reload();
        }
      });
    </script>
    {/*
    <script>
      // Domain redirect (disabled, handled by Cloudflare)
      // if (location.hostname === 'mameleon.com') {
      //   location.href = 'https://www.mameleon.com' + location.pathname + location.search + location.hash;
      // }
    </script>
    */}
    <script>
      // Language redirect
      (function() {
        const lang = localStorage.getItem('lang');
        const path = window.location.pathname;
        if (lang === 'en' && !path.startsWith('/en/')) {
          window.location.pathname = '/en' + (path === '/' ? '' : path);
        } else if (lang === 'nl' && path.startsWith('/en/')) {
          window.location.pathname = path.replace(/^\/en/, '') || '/';
        }
      })();
    </script>
  </body>
</html>