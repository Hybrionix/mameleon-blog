---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const { title, description } = Astro.props;
const path = Astro.url.pathname;

// Detect language from path
let lang = 'nl';
if (path.startsWith('/blog/en/')) lang = 'en';
else if (path.startsWith('/blog/nl/')) lang = 'nl';

// Build language switch paths
let nlPath = path.replace(/^\/blog\/en\//, '/blog/nl/');
let enPath = path.replace(/^\/blog\/nl\//, '/blog/en/');

// Fallback for non-blog pages
if (!path.startsWith('/blog/')) {
  nlPath = path.replace(/^\/en\//, '/');
  enPath = path.startsWith('/en/') ? path : '/en' + path;
}
---
<html lang={lang}>
  <head>
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <BaseHead title={title} description={description} />
  </head>
  <body>
    <Header lang={lang} nlPath={nlPath} enPath={enPath} />
    <main>
      <slot />
    </main>
    <Footer />
    <script>
      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          window.location.reload();
        }
      });
    </script>
    <script>
      // Language redirect
      (function() {
        const lang = localStorage.getItem('lang');
        const path = window.location.pathname;
        if (lang === 'en' && path.startsWith('/blog/nl/')) {
          window.location.pathname = path.replace(/^\/blog\/nl\//, '/blog/en/');
        } else if (lang === 'nl' && path.startsWith('/blog/en/')) {
          window.location.pathname = path.replace(/^\/blog\/en\//, '/blog/nl/');
        }
      })();
    </script>
  </body>
</html>