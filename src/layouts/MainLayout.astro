---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const { title, description } = Astro.props;
const path = Astro.url.pathname;

let lang = 'nl';
if (typeof window !== 'undefined') {
  // On client: use localStorage if available
  lang = localStorage.getItem('lang') || (path.startsWith('/en/') ? 'en' : 'nl');
} else {
  // On server: fallback to path
  lang = path.startsWith('/en/') ? 'en' : 'nl';
}

let nlPath = '/blog/';
let enPath = '/en/blog/';
---
<BaseHead title={title} description={description} />
<Header lang={lang} nlPath={nlPath} enPath={enPath} />
<main>
  <slot />
</main>
<Footer />

<script>
  // On first load, redirect to the correct language if localStorage is set
  (function() {
    const lang = localStorage.getItem('lang');
    const path = window.location.pathname;
    if (lang === 'en' && !path.startsWith('/en/')) {
      window.location.pathname = '/en' + path;
    } else if (lang === 'nl' && path.startsWith('/en/')) {
      window.location.pathname = path.replace(/^\/en/, '') || '/';
    }
  })();
</script>