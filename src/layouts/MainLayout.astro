---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const { title, description } = Astro.props;
const path = Astro.url.pathname;

// Detect language from path
let lang = 'nl';
if (path.startsWith('/blog/en/')) lang = 'en';
else if (path.startsWith('/blog/nl/')) lang = 'nl';

// Build language switch paths
let nlPath = path.replace(/^\/blog\/en\//, '/blog/nl/');
let enPath = path.replace(/^\/blog\/nl\//, '/blog/en/');

// Fallback for non-blog pages
if (!path.startsWith('/blog/')) {
  nlPath = path.replace(/^\/en\//, '/');
  enPath = path.startsWith('/en/') ? path : '/en' + path;
}
---
<BaseHead title={title} description={description} />
<script>
  // Domain redirect
  if (location.hostname === 'mameleon.com') {
    location.href = 'https://www.mameleon.com' + location.pathname + location.search + location.hash;
  }
  // Language redirect for blog section
  (function() {
    const lang = localStorage.getItem('lang');
    const path = window.location.pathname;
    if (lang === 'en' && path.startsWith('/blog/nl/')) {
      window.location.pathname = path.replace(/^\/blog\/nl\//, '/blog/en/');
    } else if (lang === 'nl' && path.startsWith('/blog/en/')) {
      window.location.pathname = path.replace(/^\/blog\/en\//, '/blog/nl/');
    }
  })();
</script>
<Header lang={lang} nlPath={nlPath} enPath={enPath} />
<main>
  <slot />
</main>
<Footer />